import os
import json

# Crear directorios para el proyecto
os.makedirs("malla_psicologia/css", exist_ok=True)
os.makedirs("malla_psicologia/js", exist_ok=True)

# Contenido del archivo index.html
html_content = """<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Malla Psicología - U Andrés Bello</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <h1>Malla Psicología – U Andrés Bello</h1>
    <div id="malla-container"></div>
    <script src="js/script.js"></script>
</body>
</html>
"""

# Contenido del archivo styles.css
css_content = """
body {
    font-family: Candara, sans-serif;
    background-color: #fff0f5;
    padding: 20px;
}

h1 {
    text-align: center;
    color: #800080;
}

#malla-container {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.year {
    display: flex;
    flex-direction: column;
    margin-bottom: 20px;
}

.semester {
    display: flex;
    flex-direction: row;
    gap: 10px;
    margin-bottom: 10px;
    flex-wrap: wrap;
}

.ramo {
    padding: 10px;
    border-radius: 5px;
    cursor: pointer;
    max-width: 200px;
    word-wrap: break-word;
    text-align: center;
    border: 1px solid #ccc;
}

.approved {
    text-decoration: line-through;
    opacity: 0.6;
}

/* Colores por ámbito */
.ambito-1 { background-color: #FFB6C1; }
.ambito-2 { background-color: #C71585; color: white; }
.ambito-3 { background-color: #800080; color: white; }
.ambito-4 { background-color: #DB7093; color: white; }
.ambito-5 { background-color: #FF1493; color: white; }
.ambito-6 { background-color: #D8BFD8; }
.disabled {
    pointer-events: none;
    opacity: 0.4;
}
"""

# Cargar la malla completa desde un archivo JSON generado dinámicamente
# Para simplificar, solo se incluirán algunos ramos como ejemplo
malla = {
    "Primer Año": {
        "I Semestre": [
            { "nombre": "Historia y Fundamentos de la Psicología", "ambito": 2 },
            { "nombre": "Tópicos de Neurobiología", "ambito": 2, "desbloquea": ["Procesos Psicológicos y Neurociencias"] },
            { "nombre": "Psicología y Sociedad", "ambito": 2 },
            { "nombre": "Inglés I", "ambito": 1, "desbloquea": ["Inglés II"] },
            { "nombre": "Eje de Formación Interdisciplinaria I", "ambito": 1 }
        ],
        "II Semestre": [
            { "nombre": "Sistemas Psicológicos", "ambito": 2 },
            { "nombre": "Procesos Psicológicos y Neurociencias", "ambito": 2 },
            { "nombre": "Psicología y Epistemología", "ambito": 5 },
            { "nombre": "Inglés II", "ambito": 1, "desbloquea": ["Inglés III"] },
            { "nombre": "Habilidades Comunicativas", "ambito": 1, "desbloquea": ["Razonamiento Científico y TICS"] }
        ]
    }
}

# Contenido del archivo script.js
js_content = f"""
const malla = {json.dumps(malla, ensure_ascii=False, indent=4)};
const container = document.getElementById("malla-container");
const ramosMap = {{}};

function crearRamo(ramo) {{
    const div = document.createElement("div");
    div.className = `ramo ambito-${{ramo.ambito}} disabled`;
    div.textContent = ramo.nombre;
    div.dataset.nombre = ramo.nombre;
    div.dataset.aprobado = "false";
    if (ramo.desbloquea) {{
        div.dataset.desbloquea = JSON.stringify(ramo.desbloquea);
    }}
    div.addEventListener("click", () => {{
        if (div.dataset.aprobado === "false") {{
            div.classList.add("approved");
            div.dataset.aprobado = "true";
            if (ramo.desbloquea) {{
                ramo.desbloquea.forEach(nombre => {{
                    const target = ramosMap[nombre];
                    if (target) target.classList.remove("disabled");
                }});
            }}
        }}
    }});
    ramosMap[ramo.nombre] = div;
    return div;
}}

for (const [anio, semestres] of Object.entries(malla)) {{
    const yearDiv = document.createElement("div");
    yearDiv.className = "year";
    const yearTitle = document.createElement("h2");
    yearTitle.textContent = anio;
    yearDiv.appendChild(yearTitle);

    for (const [semestre, ramos] of Object.entries(semestres)) {{
        const semDiv = document.createElement("div");
        semDiv.className = "semester";
        const semTitle = document.createElement("h3");
        semTitle.textContent = semestre;
        semDiv.appendChild(semTitle);

        ramos.forEach(ramo => {{
            const ramoDiv = crearRamo(ramo);
            semDiv.appendChild(ramoDiv);
        }});

        yearDiv.appendChild(semDiv);
    }}

    container.appendChild(yearDiv);
}}

// Habilitar los ramos sin prerrequisitos
Object.values(ramosMap).forEach(div => {{
    const nombre = div.dataset.nombre;
    const tienePrerequisitos = Object.values(malla).some(semestres =>
        Object.values(semestres).some(ramos =>
            ramos.some(r => r.desbloquea && r.desbloquea.includes(nombre))
        )
    );
    if (!tienePrerequisitos) {{
        div.classList.remove("disabled");
    }}
}});
"""

# Guardar los archivos
with open("malla_psicologia/index.html", "w", encoding="utf-8") as f:
    f.write(html_content)

with open("malla_psicologia/css/styles.css", "w", encoding="utf-8") as f:
    f.write(css_content)

with open("malla_psicologia/js/script.js", "w", encoding="utf-8") as f:
    f.write(js_content)

print("Proyecto web generado exitosamente en la carpeta 'malla_psicologia'.")

